---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import { getUrl } from "../../utils/links";

const allArticles = await getCollection("articles");
const tags = [...new Set(allArticles.flatMap((article) => article.data.tags))];

const tagCounts = tags
  .map((tag) => {
    const count = allArticles.filter((article) =>
      article.data.tags.includes(tag),
    ).length;
    return { tag, count };
  })
  .sort((a, b) => b.count - a.count);
---

<BaseLayout
  title="Browse by Topic"
  description="Ideas organized by obsession. Find your rabbit hole."
>
  <section class="container py-16">
    <div class="mx-auto max-w-6xl">
      <div class="mb-12">
        <p
          class="mb-4 font-bold uppercase tracking-wider text-meridian-burgundy dark:text-meridian-steel"
        >
          Browse by Topic
        </p>
        <h1 class="mb-6 text-5xl font-bold dark:text-gray-100 md:text-6xl">
          Find Your <span
            class="gradient-meridian bg-clip-text text-transparent"
            >Rabbit Hole</span
          >
        </h1>
        <p class="max-w-3xl text-xl text-meridian-steel dark:text-gray-300">
          We organize our thoughts into these handy categories. Fair warning:
          clicking one might lead to an hour of "just one more article"
          syndrome. üê∞
        </p>
      </div>

      {
        tagCounts.length > 0 ? (
          <div class="mb-16 grid gap-6 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4">
            {tagCounts.map(({ tag, count }) => (
              <a
                href={getUrl(`tags/${tag}`)}
                class="group relative overflow-hidden rounded-lg border-2 border-transparent transition-all duration-300 hover:border-meridian-burgundy"
              >
                <div class="bg-white p-6 transition-colors hover:bg-meridian-light-gray dark:bg-gray-800 dark:hover:bg-gray-700">
                  <h2 class="mb-2 text-2xl font-bold capitalize transition-colors group-hover:text-meridian-burgundy dark:text-gray-100 dark:group-hover:text-meridian-steel">
                    {tag}
                  </h2>
                  <p class="text-meridian-steel dark:text-gray-400">
                    {count} {count === 1 ? "perspective" : "perspectives"}
                  </p>
                  <div class="absolute bottom-2 right-2 text-6xl font-bold text-meridian-light-gray/50 transition-colors group-hover:text-meridian-burgundy/20 dark:text-gray-700/50 dark:group-hover:text-meridian-steel/20">
                    {count}
                  </div>
                </div>
              </a>
            ))}
          </div>
        ) : (
          <div class="rounded-lg bg-meridian-light-gray py-16 text-center dark:bg-gray-800">
            <p class="text-xl text-meridian-steel dark:text-gray-400">
              Tags will appear here as we publish more content.
            </p>
            <p class="mt-2 text-lg text-meridian-steel dark:text-gray-400">
              Check back soon for organized brilliance.
            </p>
          </div>
        )
      }

      <div class="rounded-lg bg-meridian-burgundy p-8 text-white">
        <h2 class="mb-4 text-2xl font-bold">Looking for Something Specific?</h2>
        <p class="mb-6 text-lg">
          No worries! Sometimes the best discoveries happen when you're looking
          for something else entirely. Try browsing all articles or hit us up
          with topic ideas.
        </p>
        <div class="flex flex-col gap-4 sm:flex-row">
          <a
            href={getUrl("articles")}
            class="btn bg-white text-meridian-burgundy hover:bg-meridian-light-gray"
          >
            See Everything
          </a>
          <a
            href={getUrl("contact")}
            class="btn border-2 border-white text-white hover:bg-white hover:text-meridian-burgundy"
          >
            Request a Topic üí°
          </a>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>
