---
import BaseLayout from "../layouts/BaseLayout.astro";
import ArticleCard from "../components/ArticleCard.astro";
import { getCollection } from "astro:content";
import { getUrl } from "../utils/links";
import { getReadingTime } from "../utils/readingTime";

const allArticles = await getCollection("articles", ({ data }) => {
  return data.draft !== true;
});

const recentArticles = allArticles
  .sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf())
  .slice(0, 6);

// Calculate reading time for each article
const articlesWithReadingTime = await Promise.all(
  recentArticles.map(async (article) => ({
    ...article,
    readingTime: await getReadingTime(article),
  })),
);
---

<BaseLayout title="Home">
  <section class="flex min-h-screen items-center justify-center py-20">
    <div class="container">
      <div class="mx-auto max-w-5xl text-center">
        <p
          class="mb-4 font-bold uppercase tracking-wider text-meridian-burgundy dark:text-meridian-steel"
        >
          Finding Your True North
        </p>
        <h1 class="mb-6 text-6xl font-bold md:text-7xl">
          <span class="gradient-meridian bg-clip-text text-transparent">
            Project Meridian
          </span>
        </h1>
        <p
          class="mb-8 text-2xl font-light leading-relaxed text-meridian-steel dark:text-gray-300 md:text-3xl"
        >
          Navigate beyond <span class="font-semibold text-meridian-burgundy"
            >"best practice"</span
          >
          toward the right way.
        </p>
        <p
          class="mx-auto mb-12 max-w-3xl text-xl text-meridian-dark dark:text-gray-300"
        >
          Like the meridian line that defines true north, we challenge leaders
          to move past "how everyone else does it" and find their authentic path
          to meaningful impact.
        </p>

        <div class="flex flex-col justify-center gap-4 sm:flex-row">
          <a
            href={getUrl("articles")}
            class="btn bg-meridian-burgundy px-8 py-3 text-lg text-white hover:bg-meridian-dark"
          >
            Explore Our Thinking
          </a>
          <a
            href={getUrl("about")}
            class="btn border-2 border-meridian-burgundy bg-transparent px-8 py-3 text-lg text-meridian-burgundy hover:bg-meridian-burgundy hover:text-white"
          >
            Get to Know Us
          </a>
        </div>
      </div>
    </div>
  </section>

  {
    recentArticles.length > 0 && (
      <section class="container border-t border-meridian-light-gray py-20 dark:border-gray-700">
        <div class="mb-12">
          <p class="mb-4 font-bold uppercase tracking-wider text-meridian-burgundy dark:text-meridian-steel">
            Fresh Off the Press
          </p>
          <div class="mb-8 flex items-end justify-between">
            <h2 class="text-4xl font-bold dark:text-gray-100 md:text-5xl">
              Charting New{" "}
              <span class="text-meridian-burgundy dark:text-meridian-steel">
                Territory
              </span>
            </h2>
            <a
              href={getUrl("articles")}
              class="btn hidden border border-meridian-burgundy bg-transparent text-meridian-burgundy hover:bg-meridian-burgundy hover:text-white sm:inline-flex"
            >
              Read More →
            </a>
          </div>
          <p class="max-w-3xl text-xl text-meridian-steel dark:text-gray-300">
            Where conventional wisdom meets its match. We question the status
            quo, challenge "industry standards," and explore what's possible
            when you dare to lead differently.
          </p>
        </div>

        <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
          {articlesWithReadingTime.map((article) => (
            <ArticleCard
              title={article.data.title}
              description={article.data.description}
              publishDate={article.data.publishDate}
              author={article.data.author}
              tags={article.data.tags}
              slug={article.slug}
              image={article.data.image}
              readingTime={article.readingTime.text}
            />
          ))}
        </div>

        <div class="mt-8 sm:hidden">
          <a
            href={getUrl("articles")}
            class="btn w-full border border-meridian-burgundy bg-transparent text-center text-meridian-burgundy hover:bg-meridian-burgundy hover:text-white"
          >
            Read More →
          </a>
        </div>
      </section>
    )
  }
</BaseLayout>
